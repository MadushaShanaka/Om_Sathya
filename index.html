<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OM ATHYA Restaurant - Menu</title>
    <style>
      :root {
        --primary-color: #a31f1f; /* A deep red/brown for food */
        --secondary-color: #2e8b57; /* Sea green for accents */
        --text-dark: #333;
        --text-light: #fff;
        --background-light: #f7f7f7;
        --cart-bg: #fff;
        --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        --header-height: 80px; /* Estimated height for header */
      }
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        background-color: var(--background-light);
        color: var(--text-dark);
        line-height: 1.6;
        display: flex;
        flex-direction: column; /* Ensure main body scrolls vertically */
        min-height: 100vh;
      }
      #app {
        display: flex;
        flex-direction: column;
        width: 100%;
      }
      #header {
        background-color: var(--primary-color);
        color: var(--text-light);
        padding: 10px 20px;
        text-align: center;
        box-shadow: var(--shadow);
        position: sticky;
        top: 0;
        z-index: 100;
        height: var(--header-height); /* Set a fixed height */
        box-sizing: border-box;
      }
      #menu-container {
        padding: 20px;
        flex-grow: 1;
        /* Added padding to prevent content being hidden behind fixed cart on mobile */
        padding-bottom: 150px;
      }
      .category {
        margin-bottom: 30px;
        padding: 15px;
        background-color: var(--cart-bg);
        border-radius: 8px;
        box-shadow: var(--shadow);
      }
      .category h2 {
        border-bottom: 2px solid var(--secondary-color);
        padding-bottom: 5px;
        margin-top: 0;
        color: var(--primary-color);
      }
      .item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px dashed #ddd;
      }
      .item:last-child {
        border-bottom: none;
      }
      .item-info {
        flex-grow: 1;
      }
      .item-name {
        font-weight: bold;
        font-size: 1.1em;
      }
      .item-options {
        display: flex;
        align-items: center;
      }
      .item-options select {
        margin-right: 10px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .add-btn {
        background-color: var(--secondary-color);
        color: var(--text-light);
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
        font-weight: bold;
      }
      .add-btn:hover {
        background-color: #247545;
      }

      /* Cart Styles (Mobile - Fixed Bottom) */
      #cart-sidebar {
        background-color: var(--cart-bg);
        border-top: 1px solid #ddd;
        padding: 15px;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        z-index: 200;
        box-sizing: border-box; /* Include padding/border in the element's total width/height */
      }
      #cart-list {
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 10px;
        padding: 5px 0;
      }
      .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0;
        border-bottom: 1px dotted #eee;
      }
      .cart-item-info {
        flex-grow: 1;
      }
      .cart-item-name {
        font-weight: bold;
      }
      .cart-item-actions button {
        background: none;
        border: 1px solid #ccc;
        padding: 2px 6px;
        cursor: pointer;
        margin: 0 3px;
        border-radius: 4px;
      }
      #total-container {
        font-size: 1.2em;
        font-weight: bold;
        margin: 10px 0;
        text-align: right;
        border-top: 2px solid #eee;
        padding-top: 10px;
      }
      #order-btn {
        width: 100%;
        background-color: var(--primary-color);
        color: var(--text-light);
        padding: 15px;
        border: none;
        border-radius: 6px;
        font-size: 1.2em;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      #order-btn:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }

      /* Desktop View: Menu and Cart are side-by-side and centered */
      @media (min-width: 900px) {
        #app {
          max-width: 1200px;
          margin: 0 auto;
          flex-direction: column; /* Keep overall layout column */
        }
        #content-wrapper {
          display: flex;
          width: 100%;
        }
        #menu-container {
          width: 65%; /* Menu takes up 65% of the centered content wrapper */
          padding-bottom: 20px; /* Remove extra bottom padding */
        }
        #cart-sidebar {
          /* Make cart sidebar sticky on the right */
          position: sticky;
          top: calc(
            var(--header-height) + 10px
          ); /* Position below the header */
          bottom: auto;
          width: 35%; /* Cart takes up 35% of the centered content wrapper */
          height: auto;
          max-height: calc(100vh - var(--header-height) - 20px);
          box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
          order: 2;
          border-top: none;
          margin-left: 15px; /* Spacing between menu and cart */
        }
        #cart-list {
          max-height: 40vh; /* Adjust height for comfortable desktop viewing */
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="header">
        <h1>OM ATHYA Resturant Menu</h1>
        <p id="table-display">
          Welcome! Please scan the QR code to find your table.
        </p>
      </div>

      <div id="content-wrapper">
        <div id="menu-container"></div>

        <div id="cart-sidebar">
          <h2>Your Order Cart</h2>
          <div id="cart-list"></div>
          <div id="total-container">
            Total: LKR <span id="cart-total">0.00</span>
          </div>
          <button id="order-btn" onclick="placeOrder()" disabled>
            Place Order via WhatsApp
          </button>
        </div>
      </div>
    </div>

    <script>
      // --- CONFIGURATION ---
      const WHATSAPP_NUMBER = "94702888722"; // Use E.164 format (Country code + number, no spaces/symbols)
      const RESTAURANT_NAME = "OM ATHYA Resturant";

      // --- MENU DATA STRUCTURE ---
      // 'Meal Bases' have a 'size' property to distinguish between 'full' and 'normal' prices.
      const menuData = [
        {
          category: "Basmathi Fride Rice",
          basePrice: true,
          items: [
            { name: "Vegitable", prices: { full: 600.0, normal: 500.0 } },
            { name: "Egg", prices: { full: 800.0, normal: 650.0 } },
            { name: "Chicken", prices: { full: 1000.0, normal: 800.0 } },
            { name: "Mix", prices: { full: 1400.0, normal: 1200.0 } },
            { name: "Seafood", prices: { full: 1300.0, normal: 1100.0 } },
          ],
        },
        {
          category: "Kottu",
          basePrice: true,
          items: [
            { name: "Vegitable", prices: { full: 600.0, normal: 500.0 } },
            { name: "Egg", prices: { full: 800.0, normal: 650.0 } },
            { name: "Chicken", prices: { full: 1000.0, normal: 800.0 } },
            { name: "Mix", prices: { full: 1400.0, normal: 1200.0 } },
            { name: "Seafood", prices: { full: 1300.0, normal: 1100.0 } },
          ],
        },
        {
          category: "Noodles",
          basePrice: true,
          items: [
            { name: "Vegitable", prices: { full: 600.0, normal: 500.0 } },
            { name: "Egg", prices: { full: 800.0, normal: 650.0 } },
            { name: "Chicken", prices: { full: 1000.0, normal: 800.0 } },
            { name: "Mix", prices: { full: 1400.0, normal: 1200.0 } },
            { name: "Seafood", prices: { full: 1300.0, normal: 1100.0 } },
          ],
        },
        {
          category: "Sring Hoppers Kottu",
          basePrice: true,
          items: [
            { name: "Vegitable", prices: { full: 500.0, normal: 450.0 } },
            { name: "Egg", prices: { full: 650.0, normal: 500.0 } },
            { name: "Chicken", prices: { full: 800.0, normal: 600.0 } },
            { name: "Cheese", prices: { full: 1000.0, normal: 900.0 } },
            { name: "Mix", prices: { full: 1300.0, normal: 1200.0 } },
          ],
        },
        // Fixed Price Items (No Size/Type selection)
        {
          category: "Rice (Fixed Price)",
          items: [
            { name: "Nasi goreng Rice", price: 1600.0 },
            { name: "Biriyani Rice", price: 1700.0 },
            { name: "Mongolian Rice", price: 1600.0 },
          ],
        },
        {
          category: "Chopsuey Rice",
          items: [
            { name: "Chicken", price: 2000.0 },
            { name: "Seafood", price: 2500.0 },
            { name: "Mix", price: 2800.0 },
            { name: "Vegitable", price: 1600.0 },
          ],
        },
        {
          category: "Chopsuey",
          items: [
            { name: "Vegitable Chopsuey", price: 700.0 },
            { name: "Chicken Chopsuey", price: 1300.0 },
            { name: "Seafood Chopsuey", price: 1600.0 },
            { name: "Mix Chopsuey", price: 1900.0 },
          ],
        },
        {
          category: "Omlet",
          items: [
            { name: "Chicken Omlet", price: 700.0 },
            { name: "Egg Omlet", price: 400.0 },
            { name: "Cheese Omlet", price: 800.0 },
            { name: "Cheese Chicken Omlet", price: 950.0 },
            { name: "Omlet + Vegetable Salad (Add-on)", price: 60.0 },
            { name: "Omlet + Chicken Salad Chips (Add-on)", price: 150.0 },
          ],
        },
        {
          category: "Speciate / Bites",
          items: [
            {
              name: "Speciate Platter (Chips 100g, Chicken 200g, Sauces)",
              price: 2500.0,
            },
            { name: "Chicken Bite - Fried (400g)", price: 1700.0 },
            { name: "Chicken Bite - Curry (400g)", price: 1700.0 },
            { name: "Chicken Bite - Devilled (400g)", price: 1700.0 },
            { name: "Prawns Bite - Fried (400g)", price: 1700.0 },
            { name: "Prawns Bite - Curry", price: 2000.0 },
            { name: "Prawns Bite - Butter Fried", price: 2000.0 },
            { name: "Prawns Bite - Devilled", price: 2000.0 },
            { name: "Prawns Bite - Hot Butter", price: 2000.0 },
            { name: "Gal Malu Bite (400g)", price: 2000.0 },
            { name: "Cuttle Fish Bite - Stew (400g)", price: 2000.0 },
            { name: "Cuttle Fish Bite - Butter (400g)", price: 2000.0 },
            { name: "Cuttle Fish Bite - Butter Fried (400g)", price: 2000.0 },
            { name: "Cuttle Fish Bite - Devilled (400g)", price: 2000.0 },
            { name: "Fish Bite - Fried (400g)", price: 1700.0 },
            { name: "Thalapath Bite - Curry (400g)", price: 2000.0 },
            { name: "Hot Butter Mushroom", price: 700.0 },
            { name: "Sausage (10 fingers) - Fried/Devilled", price: 700.0 },
          ],
        },
        {
          category: "Bite - Vegetable & Sides",
          items: [
            { name: "Vegetable Bite - Boiled", price: 700.0 },
            { name: "Vegetable Bite - Cashew", price: 800.0 },
            { name: "Vegetable Salad Bite", price: 700.0 },
            { name: "Potato Chips", price: 600.0 },
            { name: "Stir Fried Veg", price: 600.0 },
            { name: "Onion Salad", price: 250.0 },
          ],
        },
      ];

      // --- GLOBAL STATE ---
      let cart = [];
      let tableNumber = null;

      // --- INITIALIZATION ---
      document.addEventListener("DOMContentLoaded", () => {
        parseTableId();
        renderMenu();
        updateCart();
      });

      // --- TABLE ID HANDLER ---
      function parseTableId() {
        const urlParams = new URLSearchParams(window.location.search);
        const table = urlParams.get("table");
        const tableDisplay = document.getElementById("table-display");

        if (table && !isNaN(parseInt(table))) {
          tableNumber = parseInt(table);
          tableDisplay.innerHTML = `You are ordering from **Table ${tableNumber}**!`;
        } else {
          tableDisplay.innerHTML =
            "Table number not found in URL. Please scan the QR code to order.";
        }
      }

      // --- MENU RENDERING ---
      function renderMenu() {
        const menuContainer = document.getElementById("menu-container");
        menuContainer.innerHTML = "";

        menuData.forEach((cat, catIndex) => {
          const categoryDiv = document.createElement("div");
          categoryDiv.className = "category";
          categoryDiv.innerHTML = `<h2>${cat.category}</h2>`;

          cat.items.forEach((item, itemIndex) => {
            const itemDiv = document.createElement("div");
            itemDiv.className = "item";

            const itemInfo = document.createElement("div");
            itemInfo.className = "item-info";
            itemInfo.innerHTML = `<div class="item-name">${item.name}</div>`;

            const itemOptions = document.createElement("div");
            itemOptions.className = "item-options";

            let priceToDisplay;

            if (cat.basePrice) {
              // For items with 'full' and 'normal' sizes (Rice, Kottu, Noodles)
              priceToDisplay = `LKR ${item.prices.full.toFixed(2)} (Full)`;

              const sizeSelect = document.createElement("select");
              sizeSelect.id = `select-${catIndex}-${itemIndex}`;

              // Add Full option
              let fullOption = document.createElement("option");
              fullOption.value = `full:${item.prices.full}`;
              fullOption.textContent = `Full (LKR ${item.prices.full.toFixed(
                2
              )})`;
              sizeSelect.appendChild(fullOption);

              // Add Normal option
              let normalOption = document.createElement("option");
              normalOption.value = `normal:${item.prices.normal}`;
              normalOption.textContent = `Normal (LKR ${item.prices.normal.toFixed(
                2
              )})`;
              sizeSelect.appendChild(normalOption);

              itemOptions.appendChild(sizeSelect);
            } else {
              // For fixed-price items
              priceToDisplay = `LKR ${item.price.toFixed(2)}`;
              itemInfo.innerHTML += `<div>${priceToDisplay}</div>`;
            }

            const addBtn = document.createElement("button");
            addBtn.className = "add-btn";
            addBtn.textContent = "Add to Cart";
            addBtn.onclick = () =>
              addItemToCart(
                catIndex,
                itemIndex,
                cat.basePrice
                  ? document.getElementById(`select-${catIndex}-${itemIndex}`)
                      .value
                  : null
              );

            itemOptions.appendChild(addBtn);

            itemDiv.appendChild(itemInfo);
            itemDiv.appendChild(itemOptions);
            categoryDiv.appendChild(itemDiv);
          });

          menuContainer.appendChild(categoryDiv);
        });
      }

      // --- CART LOGIC ---
      function addItemToCart(catIndex, itemIndex, sizeValue) {
        const cat = menuData[catIndex];
        const item = cat.items[itemIndex];

        let itemName = item.name;
        let itemPrice;
        let cartItemId;

        if (cat.basePrice) {
          // Base Price Item (Rice, Kottu, Noodles, Sring Hoppers Kottu)
          const [size, price] = sizeValue.split(":");
          itemName = `${item.name} (${
            size.charAt(0).toUpperCase() + size.slice(1)
          })`;
          itemPrice = parseFloat(price);
          cartItemId = `${catIndex}-${itemIndex}-${size}`;
        } else {
          // Fixed Price Item
          itemPrice = item.price;
          cartItemId = `${catIndex}-${itemIndex}-fixed`;
        }

        const existingItem = cart.find((i) => i.id === cartItemId);

        if (existingItem) {
          existingItem.quantity++;
        } else {
          cart.push({
            id: cartItemId,
            name: itemName,
            price: itemPrice,
            quantity: 1,
          });
        }

        updateCart();
      }

      function changeQuantity(itemId, delta) {
        const item = cart.find((i) => i.id === itemId);
        if (!item) return;

        item.quantity += delta;

        if (item.quantity <= 0) {
          cart = cart.filter((i) => i.id !== itemId);
        }

        updateCart();
      }

      function updateCart() {
        const cartList = document.getElementById("cart-list");
        const cartTotalSpan = document.getElementById("cart-total");
        const orderBtn = document.getElementById("order-btn");
        let total = 0;

        if (!cartList || !cartTotalSpan || !orderBtn) {
          return;
        }

        // Clear the existing cart display
        cartList.innerHTML = "";

        if (cart.length === 0) {
          // Dynamically add the "empty" message when the cart is empty
          const p = document.createElement("p");
          p.textContent = "Your cart is empty.";
          p.style.fontStyle = "italic";
          cartList.appendChild(p);
          orderBtn.disabled = true;
        } else {
          orderBtn.disabled = tableNumber === null;

          cart.forEach((item) => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;

            const cartItemDiv = document.createElement("div");
            cartItemDiv.className = "cart-item";

            cartItemDiv.innerHTML = `
                        <div class="cart-item-info">
                            ${item.quantity}x **${item.name}** <br>
                            <small>LKR ${item.price.toFixed(2)} each</small>
                        </div>
                        <div class="cart-item-actions">
                            <button onclick="changeQuantity('${
                              item.id
                            }', -1)">-</button>
                            <button onclick="changeQuantity('${
                              item.id
                            }', 1)">+</button>
                        </div>
                        <div class="cart-item-price">LKR ${itemTotal.toFixed(
                          2
                        )}</div>
                    `;
            cartList.appendChild(cartItemDiv);
          });
        }

        cartTotalSpan.textContent = total.toFixed(2);
        if (tableNumber === null) {
          orderBtn.textContent = "Place Order (Table ID Missing)";
        } else {
          orderBtn.textContent = `Place Order via WhatsApp (Total: LKR ${total.toFixed(
            2
          )})`;
        }
      }

      // --- WHATSAPP GENERATOR ---
      function placeOrder() {
        if (cart.length === 0 || tableNumber === null) {
          alert(
            "Please select items and ensure a Table ID is present in the URL."
          );
          return;
        }

        let message = `*${RESTAURANT_NAME} - New Order*\n\n`;
        message += `*Table No:* ${tableNumber}\n\n`;
        message += `*--- Order Details ---\n*`;

        let total = 0;
        cart.forEach((item) => {
          const itemTotal = item.price * item.quantity;
          total += itemTotal;
          message += `${item.quantity}x ${item.name} (LKR ${item.price.toFixed(
            2
          )}) = LKR ${itemTotal.toFixed(2)}\n`;
        });

        message += `*------------------------*\n`;
        message += `*GRAND TOTAL: LKR ${total.toFixed(2)}*\n\n`;
        message += `_Please acknowledge this order and confirm the delivery time._`;

        const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(
          message
        )}`;

        // Open WhatsApp in a new tab
        window.open(whatsappUrl, "_blank");

        // Optional: Clear the cart after successfully opening the WhatsApp link
        // cart = [];
        // updateCart();
      }
    </script>
  </body>
</html>
